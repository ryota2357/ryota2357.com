---
import { getCollection } from "astro:content";
import Base from "@/layouts/Base.astro";

const allBlogCollection = await getCollection("blog");
const allTagCount = (() => {
  const tagMap = allBlogCollection
    .flatMap((post) => post.data.tags)
    .reduce(
      (map, tag) => map.set(tag, (map.get(tag) ?? 0) + 1),
      new Map<string, number>(),
    );
  return [...tagMap].map(([name, count]) => ({ name, count }));
})();
---

<Base title="Blog.Tag" slug="/blog/tag/">
  <h1>
    <span class="text-[1.6rem]"><a href="/blog/">Blog</a>.</span>
    <span class="text-[2.5rem]">Tag</span>
  </h1>
  <ul class="mt-8 list-inside list-disc">
    {
      allTagCount
        .sort((a, b) => a.name.localeCompare(b.name))
        .sort((a, b) => b.count - a.count)
        .map(({ name, count }) => (
          <li>
            <a href={`/blog/tag/${name}`}>{`${name}(${count})`}</a>
          </li>
        ))
    }
  </ul>
</Base>
